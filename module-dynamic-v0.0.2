#%Module
set     name        reflector-hdf5
set     version     0.0.1
set     root        /usr/common/software/$name/$version

set     fullname    reflector-hdf5
set     externalurl https://github.com/NERSC/LibWrap
set     nerscurl    https://www.nersc.gov
set     maincategory    applications
set     subcategory "programming"
set     description "Function Tracer and logging"

proc ModulesHelp { } {
        global description nerscurl externalurl
        puts stderr "Description - $description"
        puts stderr "NERSC Docs  - $nerscurl"
        puts stderr "Other Docs  - $externalurl"
}

set LCcompiler intel

if { [ info exists env(PE_ENV) ] } {
           set compiler $env(PE_ENV)
} else {
           set compiler 0
}

if  { $compiler == "0" } {
            set LCcompiler intel
} elseif { $compiler == "GNU" } {
            set LCcompiler gnu
} elseif { $compiler == "CRAY" } {
            set LCcompiler cray
} elseif { $compiler == "INTEL" } {
            set LCcompiler intel
}



### For Dynamic compiler selection set dynamic path ###
set PREFIX /global/common/cori_cle6/software/modulefiles/reflector-hdf5/$LCcompiler

### This following PREFIX is for default compiler ###
#set PREFIX /global/common/cori_cle6/software/modulefiles/reflector-hdf5



if { [ info exists ::env(CRAYPE_LINK_TYPE) ] } {
    if {$env(CRAYPE_LINK_TYPE) == "dynamic"} {
    
        remove-path PKG_CONFIG_PATH $PREFIX
        remove-path PE_PKGCONFIG_LIBS wraphdf5static
        
        prepend-path LD_LIBRARY_PATH /global/common/cori_cle6/software/rabbitmq/0.9.0/lib64
        prepend-path LD_LIBRARY_PATH /global/common/cori_cle6/software/jansson/lib
        prepend-path LD_PRELOAD $PREFIX/libwraphdf5.so
  } elseif {$env(CRAYPE_LINK_TYPE) == "static"} {
      
        prepend-path PKG_CONFIG_PATH $PREFIX
        prepend-path PE_PKGCONFIG_LIBS wraphdf5static
       # static gotcha, openssl, rabbitmq, jansson will be  used by Makefile 
  }

} else {
        prepend-path PKG_CONFIG_PATH $PREFIX
        prepend-path PE_PKGCONFIG_LIBS wraphdf5static
        
        prepend-path LD_LIBRARY_PATH /global/common/cori_cle6/software/rabbitmq/0.9.0/lib64
	prepend-path LD_LIBRARY_PATH /global/common/cori_cle6/software/jansson/lib
        prepend-path LD_PRELOAD $PREFIX/libwraphdf5.so
}

